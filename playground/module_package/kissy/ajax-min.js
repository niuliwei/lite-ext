/*
Copyright 2011, KISSY UI Library v1.1.7dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("ajax/impl",function(e,w,K,x){function j(a){a=e.merge(L,a);if(!a.url)return x;if(a.data&&!e.isString(a.data))a.data=e.param(a.data);a.context=a.context||a;var b,d=n,g,f=a.type.toUpperCase();if(a.dataType===y){b=a.jsonpCallback||y+e.now();a.url=a.url+(a.url.indexOf("?")===-1?"?":"&")+(a.jsonp+"="+b);a.dataType=D;var o=i[b];i[b]=function(k){if(e.isFunction(o))o(k);else{i[b]=x;try{delete i[b]}catch(h){}}p([n,q],k,d,c,a)}}if(a.data&&f===z)a.url=a.url+(a.url.indexOf("?")===-1?"?":"&")+a.data;
if(a.dataType===D){l(E,a);f=e.getScript(a.url,b?null:function(){p([n,q],t,d,c,a)});l(F,a);return f}var r=false,c=a.xhr();l(E,a);c.open(f,a.url,a.async);try{if(a.data||a.contentType)c.setRequestHeader(G,a.contentType);c.setRequestHeader("Accept",a.dataType&&a.accepts[a.dataType]?a.accepts[a.dataType]+", */*; q=0.01":a.accepts._default)}catch(N){}c.onreadystatechange=function(k){if(!c||c.readyState===0||k==="abort"){r||p(q,null,s,c,a);r=true;if(c)c.onreadystatechange=H}else if(!r&&c&&(c.readyState===
4||k===u)){r=true;c.onreadystatechange=H;var h;if(k===u)h=u;else{a:{try{h=c.status>=200&&c.status<300||c.status===304||c.status===1223;break a}catch(O){}h=false}h=h?n:s}d=h;try{h=c;var v=a.dataType,A=t,I,m=h;if(!e.isString(m)){A=h.getResponseHeader(G)||t;m=(I=v==="xml"||!v&&A.indexOf("xml")>=0)?h.responseXML:h.responseText;if(I&&m.documentElement.nodeName===B)throw B;}if(e.isString(m))if(v===C||!v&&A.indexOf(C)>=0)m=K.parse(m);g=m}catch(P){d=B}p([d===n?n:s,q],g,d,c,a);if(k===u){c.abort();l(M,a)}if(a.async)c=
null}};l(F,a);try{c.send(f===J?a.data:null)}catch(Q){p([s,q],g,s,c,a)}a.async||l(q,a);return c}function p(a,b,d,g,f){if(e.isArray(a))e.each(a,function(o){p(o,b,d,g,f)});else{d===a&&f[a]&&f[a].call(f.context,b,d,g);l(a,f)}}function l(a,b){j.fire(a,{ajaxConfig:b})}var i=window,H=function(){},z="GET",J="POST",G="Content-Type",C="json",y=C+"p",D="script",t="",E="start",F="send",M="stop",n="success",q="complete",s="error",u="timeout",B="parsererror",L={type:z,url:t,contentType:"application/x-www-form-urlencoded",
async:true,data:null,xhr:i.ActiveXObject?function(){if(i.XmlHttpRequest)try{return new i.XMLHttpRequest}catch(a){}try{return new i.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}:function(){return new i.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},jsonp:"callback"};e.mix(j,w);e.mix(j,{get:function(a,b,d,g,f){if(e.isFunction(b)){g=d;d=b}return j({type:f||
z,url:a,data:b,success:function(o,r,c){d&&d.call(this,o,r,c)},dataType:g})},post:function(a,b,d,g){if(e.isFunction(b)){g=d;d=b;b=x}return j.get(a,b,d,g,J)},jsonp:function(a,b,d){if(e.isFunction(b)){d=b;b=null}return j.get(a,b,d,y)}});return j},{requires:["event","json"]});KISSY.add("ajax",function(e,w){return w},{requires:["ajax/impl"]});
