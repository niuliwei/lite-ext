/*
Copyright 2011, KISSY UI Library v1.1.7dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("imagezoom/autorender",function(l,m,g,h){h.autoRender=function(p,q){p="."+(p||"KS_Widget");m.query(p,q).each(function(n){var i;if(n.getAttribute("data-widget-type")==="ImageZoom")try{if(i=n.getAttribute("data-widget-config"))i=i.replace(/'/g,'"');new h(n,g.parse(i))}catch(j){}})}},{requires:["dom","json","imagezoom/base"]});
KISSY.add("imagezoom/base",function(l,m,g,h,p,q,n,i,j){function k(a){return l.require("uibase/"+a)}return q.create([k("box"),k("contentbox"),k("position"),k("loading"),h.ie==6?k("shim"):null,k("align"),k("mask"),i],{initializer:function(){var a=this,b;(b=a.image=a.get("imageNode"))&&i.__imgOnLoad(b,function(){if(!a.imageWrap){a._render();a._bind()}})},renderUI:function(){},syncUI:function(){},bindUI:function(){},destructor:function(){this.image.detach()},_render:function(){var a=this.image;(this.imageWrap=
(new n(l.substitute("<div class='{wrapClass}'></div>",{wrapClass:this.get("wrapClass")}))).insertBefore(a)).prepend(a);if(this.get("showIcon")){this.icon=new n(l.substitute("<span class='{iconClass}'></span>",{iconClass:this.get("iconClass")}));this.imageWrap.append(this.icon)}},_bind:function(){var a=this,b;a.image.on("mouseenter",function(c){if(a.get("hasZoom"))b=l.later(function(){a.set("currentMouse",c);a.show();b=j},100)}).on("mouseleave",function(){if(b){b.cancel();b=j}})},_uiSetHasZoom:function(a){if(a)this.icon&&
this.icon.show();else this.icon&&this.icon.hide()}},{ATTRS:{imageNode:{setter:function(a){return n.one(a)}},wrapClass:{value:"ks-imagezoom-wrap"},imageWidth:{valueFn:function(){var a=this.get("imageNode");return(a=a&&a.width())||400}},imageHeight:{valueFn:function(){var a=this.get("imageNode");return(a=a&&a.height())||400}},imageLeft:{valueFn:function(){var a=this.get("imageNode");return(a=a&&a.offset().left)||400}},imageTop:{valueFn:function(){var a=this.get("imageNode");return(a=a&&a.offset().top)||
400}},hasZoom:{value:true,setter:function(a){return!!a}},showIcon:{value:true},iconClass:{value:"ks-imagezoom-icon"}}})},{requires:["dom","event","ua","anim","uibase","node","imagezoom/zoomer"]});
KISSY.add("imagezoom/zoomer",function(l,m,g){function h(){var a;if((a=this.get("bigImageSrc"))&&this.get("preload"))(new Image).src=a;this._isInner=this.get("type")===n}function p(a,b){var c=a[0];c&&c.complete&&c.clientWidth?b():a.on("load",b)}var q=new m(document.body),n="inner",i=/^.+\.(?:jpg|png|gif)$/i,j=Math.round,k=Math.min;h.ATTRS={width:{valueFn:function(){return this.get("imageWidth")}},height:{valueFn:function(){return this.get("imageHeight")}},elCls:{value:"ks-imagezoom-viewer"},elStyle:{value:{overflow:"hidden",
position:"absolute"}},type:{value:"standard"},preload:{value:true},bigImageSrc:{setter:function(a){if(a&&i.test(a))return a;return this.get("bigImageSrc")},valueFn:function(){var a=this.get("imageNode");if(a)if((a=a.attr("data-ks-imagezoom"))&&i.test(a))return a;return g}},bigImageWidth:{valueFn:function(){var a=this.bigImage;return(a=a&&a.width())||800}},bigImageHeight:{valueFn:function(){var a=this.bigImage;return(a=a&&a.height())||800}},currentMouse:{value:g},lensClass:{value:"ks-imagezoom-lens"},
lensHeight:{value:g},lensWidth:{value:g},lensTop:{value:g},lensLeft:{value:g}};h.HTML_PARSER={};l.augment(h,{__renderUI:function(){var a=this,b;a.viewer=a.get("contentEl");b=a.bigImage=(new m('<img src="'+a.get("bigImageSrc")+'" />')).css("position","absolute").appendTo(a.viewer);a._setLensSize();a._setLensOffset();if(a._isInner)a._bigImageCopy=(new m('<img src="'+a.image.attr("src")+'"  />')).css("position","absolute").width(a.get("bigImageWidth")).height(a.get("bigImageHeight")).prependTo(a.viewer);
else a.lens=(new m('<div class="'+a.get("lensClass")+'"></div>')).css("position","absolute").appendTo(q).hide();a.viewer.appendTo(a.get("el"));p(b,function(){a._setLensSize();a.set("bigImageWidth",b.width());a.set("bigImageHeight",b.height())})},__bindUI:function(){var a=this;a.on("show",function(){var b=a.icon;b&&b.hide();a._isInner&&a._anim(0.4,42);q.on("mousemove",a._mouseMove,a)});a.on("hide",function(){var b=a.lens;b&&b.hide();(b=a.icon)&&b.show();q.detach("mousemove",a._mouseMove,a)})},__syncUI:function(){},
__destructor:function(){this.viewer.remove();this.lens.remove()},_setLensSize:function(){var a=this.get("imageWidth"),b=this.get("imageHeight"),c=this.get("bigImageWidth"),e=this.get("bigImageHeight"),d=this.get("width"),r=this.get("height");this.set("lensWidth",k(j(d*a/c),a));this.set("lensHeight",k(j(r*b/e),b))},_setLensOffset:function(a){a=a||this.get("currentMouse");var b=this.get("imageLeft"),c=this.get("imageTop"),e=this.get("imageWidth"),d=this.get("imageHeight");this.get("width");this.get("height");
var r=this.get("lensWidth"),o=this.get("lensHeight"),f=a.pageX-r/2;a=a.pageY-o/2;if(f<=b)f=b;else if(f>=e+b-r)f=e+b-r;if(a<=c)a=c;else if(a>=d+c-o)a=d+c-o;this.set("lensLeft",f);this.set("lensTop",a)},_mouseMove:function(a){var b=this.get("imageLeft"),c=this.get("imageTop"),e=this.get("imageWidth"),d=this.get("imageHeight");a.pageX>b&&a.pageX<b+e&&a.pageY>c&&a.pageY<c+d?this.set("currentMouse",a):this.hide()},_anim:function(a,b){var c=this,e,d=1;e=c.get("imageLeft");var r=c.get("imageTop"),o=c.get("imageWidth"),
f=c.get("imageHeight"),v=c.get("bigImageWidth"),w=c.get("bigImageHeight"),x=-j((c.get("lensLeft")-e)*v/o),y=-j((c.get("lensTop")-r)*w/f),s,t,u;c._animTimer&&c._animTimer.cancel();c.bigImage.width(o).height(f);c._bigImageCopy.width(o).height(f);c._animTimer=l.later(e=function(){s=o+(v-o)/b*d;t=f+(w-f)/b*d;u={left:x/b*d,top:y/b*d};c.bigImage.width(s).height(t).css(u);c._bigImageCopy.width(s).height(t).css(u);if(++d>b){c._animTimer.cancel();c._animTimer=g}},a*1E3/b,true);e()},_uiSetCurrentMouse:function(a){if(!(!this.bigImage||
this._animTimer)){var b=this.lens;b&&b.show();this._setLensOffset(a);a={left:-j((this.get("lensLeft")-this.get("imageLeft"))*this.get("bigImageWidth")/this.get("imageWidth")),top:-j((this.get("lensTop")-this.get("imageTop"))*this.get("bigImageHeight")/this.get("imageHeight"))};this._bigImageCopy&&this._bigImageCopy.css(a);this.bigImage.css(a)}},_uiSetLensWidth:function(a){this.lens&&this.lens.width(a)},_uiSetLensHeight:function(a){this.lens&&this.lens.height(a)},_uiSetLensTop:function(a){this.lens&&
this.lens.offset({top:a})},_uiSetLensLeft:function(a){this.lens&&this.lens.offset({left:a})},_uiSetBigImageWidth:function(a){a&&this.bigImage&&this.bigImage.width(a);a&&this._bigImageCopy&&this._bigImageCopy.width(a)},_uiSetBigImageHeight:function(a){a&&this.bigImage&&this.bigImage.height(a);a&&this._bigImageCopy&&this._bigImageCopy.height(a)},_uiSetBigImageSrc:function(a){a&&this.bigImage&&this.bigImage.attr("src",a);a&&this._bigImageCopy&&this._bigImageCopy.attr("src",a)}});h.__imgOnLoad=p;return h},
{requires:["node"]});KISSY.add("imagezoom",function(l,m){return m},{requires:["imagezoom/base","imagezoom/autorender"]});
