KISSY.Editor.add("bubbleview",function(){var g=KISSY,h=g.Editor,j=g.Event,l=g.DOM;if(h.BubbleView)g.log("attach bubbleview more","warn");else{var f=g.UIBase.create(h.Overlay,[],{renderUI:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var a=this._selectedEl,c=a._4e_getOffset(document);c.top+=a.height()+5;f.superclass.show.call(this);this.set("xy",[c.left,c.top])},destructor:function(){h.Utils.destroyRes.call(this)}},{ATTRS:{focus4e:false,zIndex:{value:h.baseZIndex(h.zIndexManager.BUBBLE_VIEW)}}}),
i={};f.destroy=function(a){if((a=i[a])&&a.bubble){a.bubble.destroy();a.bubble=null}};f.attach=function(a){var c=a.pluginName;g.mix(a,i[c].cfg,false);var m=a.pluginContext,n=a.func,k=a.editor,b=a.bubble;k.on("selectionChange",function(d){d=d.path;var e=d.elements;if(d&&e)if(d=d.lastElement)if(d=n(d)){e=i[c];if(!e.bubble){e.bubble=new f({autoRender:true});e.cfg.init&&e.cfg.init.call(e.bubble)}b=e.bubble;b._selectedEl=d;b._plugin=m;b.hide();b.show()}else if(b){b._selectedEl=b._plugin=null;b.hide()}});
j.on(l._4e_getWin(k.document),"scroll blur",function(){b&&b.hide()})};f.register=function(a){var c=a.pluginName;i[c]=i[c]||{cfg:a};j.on(document,"click",function(){a.bubble&&a.bubble.hide()});a.editor&&f.attach(a)};h.BubbleView=f}},{attach:false,requires:["overlay"]});
