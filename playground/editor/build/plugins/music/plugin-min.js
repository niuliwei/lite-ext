KISSY.Editor.add("music",function(e){e.addPlugin("music",function(){var c=KISSY.Editor,d=e.htmlDataProcessor,g=d&&d.dataFilter;g&&g.addRules({elements:{object:function(a){var b=a.attributes;if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<a.children.length;b++)if(a.children[b].name=="embed"){if(!c.Utils.isFlashEmbed(a.children[b]))break;if(a.children[b].attributes.src.indexOf("niftyplayer.swf")!=-1)return d.createFakeParserElement(a,"ke_music","music",true)}return null}for(b=0;b<a.children.length;b++){var f=
a.children[b];if(f.name=="param"&&f.attributes.name=="movie")if(f.attributes.value.indexOf("niftyplayer.swf")!=-1)return d.createFakeParserElement(a,"ke_music","music",true)}},embed:function(a){if(!c.Utils.isFlashEmbed(a))return null;if(a.attributes.src.indexOf("niftyplayer.swf")!=-1)return d.createFakeParserElement(a,"ke_music","music",true)}}},4);var h=e.addButton("music",{contentCls:"ke-toolbar-music",title:"\u63d2\u5165\u97f3\u4e50",mode:c.WYSIWYG_MODE,loading:true});c.use("music/support",function(){var a=new c.MusicInserter(e);
h.reload({offClick:function(){a.show()},destroy:function(){a.destroy()}})});this.destroy=function(){h.destroy()}})},{attach:false,requires:["fakeobjects"]});
